<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>My Chat App</title>
<link rel="stylesheet" href="style.css"> 
    <!-- è¨­å®šå†…å®¹ -->
</head>
<body>
    <div id="appTitle">
        <h1>My Chat App</h1>
    </div>
    <div id="header">
        <div id="hamburgerIcon">&#9776; è¨­å®š</div>
    </div>
    <div id="settings" style="display: none;">
        <!-- è¨­å®šå†…å®¹ -->
        <div>
            <label for="fontSize">ãƒ•ã‚©ãƒ³ãƒˆã‚µã‚¤ã‚º:</label>
            <select id="fontSize">
                <option value="small">å°ã•ã„</option>
                <option value="medium" selected>æ¨™æº–</option>
                <option value="large">å¤§ãã„</option>
            </select>
        </div>
        <div>
            <label for="theme">ãƒ†ãƒ¼ãƒ:</label>
            <select id="theme">
                <option value="light" selected>ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰</option>
                <option value="dark">ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰</option>
            </select>
        </div>
        <div>
            <label for="language">è¨€èª:</label>
            <select id="language">
                <option value="ja" selected>æ—¥æœ¬èª</option>
                <option value="en">English</option>
            </select>
        </div>
    </div>
       
    
    <!-- è¨­å®šå†…å®¹ -->
    <div>
        <input type="text" id="searchQuery" placeholder="ãƒ¡ãƒ¢ã‚’æ¤œç´¢...">
        <button id="searchButton">æ¤œç´¢</button>
    </div>
<!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->
<div> 
    åå‰ï¼š<input type="text" id="uname"> 
</div>
<div style="display: flex; align-items: center;">
    <div>
        æ—¥ä»˜ï¼š<input type="date" id="day">
    </div>
    <div style="margin-left: 10px;">
        <label for="category">ã‚«ãƒ†ã‚´ãƒª:</label>
        <select id="category">
            <option value="ä»•äº‹">ä»•äº‹</option>
            <option value="å€‹äºº">å€‹äºº</option>
            <option value="å®¶åº­">å®¶åº­</option>
            <!-- ä»–ã®ã‚«ãƒ†ã‚´ãƒªã‚ªãƒ—ã‚·ãƒ§ãƒ³ -->
        </select>
    </div>
</div>
<div>
    <textarea id="text" cols="30" rows="10"></textarea>
    <button id="send">é€ä¿¡</button>
</div>
<div id="output" style="overflow: auto;height: auto;"></div>

<div id="shareButtons">
    <button id="shareOnLine">LINEã§å…±æœ‰</button>
    <button id="shareOnTwitter">Twitterã§å…±æœ‰</button>
</div>
<!--/ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->



<!-- JQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<!--** ä»¥ä¸‹Firebase **-->
<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getDatabase, ref, push, set,update,remove, onChildAdded, onChildChanged, onChildRemoved } 
    from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyApiys7KPXh3WlPtWkAimEd8dRJKVVeY7k",
      authDomain: "self-coath.firebaseapp.com",
      databaseURL: "https://self-coath-default-rtdb.firebaseio.com",
      projectId: "self-coath",
      storageBucket: "self-coath.appspot.com",
      messagingSenderId: "375259169680",
      appId: "1:375259169680:web:f510004f6764f128542915",
      measurementId: "G-3JB40K3NG4"
    };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);//RealtimeDBã«æ¥ç¶š
    const dbRef = ref(db, "chat");//RealtimeDBå†…ã®"chat"ã‚’ä½¿ã†


    // é€ä¿¡
    $("#send").on("click",function() {
    const msg = {
        uname: $("#uname").val(),
        day: $("#day").val(),
        text: $("#text").val()
    }
    // console.log(msg); //ãƒã‚§ãƒƒã‚¯ã—ãŸã‚‰æ¶ˆã™
    const newPostRef = push(dbRef); //ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚­ãƒ¼ã‚’ç”Ÿæˆ
    set(newPostRef, msg);           //"chat"ã«ãƒ¦ãƒ‹ãƒ¼ã‚¯KEYã‚’ã¤ã‘ã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²
    console.log(newPostRef);//ã“ã‚Œã‚’ã¿ãŸã‚‰ã€ã©ã†ã„ã†å‡¦ç†ãªã‚“ã‹ã‚ã‹ã‚‹ï¼
});
    // å—è¨º
    onChildAdded(dbRef, function (data) {
        const msg =data.val();
        const key =data.key; //ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚­ãƒ¼ å‰Šé™¤ãƒ»æ›´æ–°ã«å¿…é ˆ
        let h ='<p id="'+key+'">';
            h += msg.uname;
            h += msg.day;
            h += '<span contentEditable="true"id="'+key+'_update">'+msg.text+'</span>';
            h += '<span class="remove" data-key="'+key+'">ğŸš®</span>'
            h += '<span class="update" data-key="'+key+'">ğŸ†™</span>'
            // h += msg.text;
            h +='</p>';
            $("#output").prepend(h);
});

    // å‰Šé™¤ã‚¤ãƒ™ãƒ³ãƒˆ
    $("#output").on("click",".remove",function(){
        const key = $(this).atte("data-key");
        const remove_item = ref(db,"chat/+key");
        remove(remove_item);//Firebaseãƒ‡ãƒ¼ã‚¿å‰Šé™¤é–¢æ•°
    });

    // æ›´æ–°ã‚¤ãƒ™ãƒ³ãƒˆ
    $("#output").on("click", ".update", function() {
        const key = $(this).attr("data-key");
        update(ref(db, "chat/"+key),{
            text:$("#" + key+'_update').html()

        });
    });

// å‰Šé™¤å‡¦ç†ãŒFirebaseå´ã§å®Ÿè¡Œã•ã‚ŒãŸã‚‰
onChildRemoved(dbRef, (data) =>{
    $("#"+data.key).remobe(); //DOMæ“ä½œé–¢æ•°ï¼ˆå¯¾è±¡ã‚’å‰Šé™¤ï¼‰
})

// æ›´æ–°å‡¦ç†ãŒFirebaseå´ã§ã˜ã£ã“ã†ã•ã‚ŒãŸã‚‰ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿï¼
onChildChanged(dbRef, (data) =>{
  $("#"+data.key+'_update').html(data.val().text);
  $("#"+data.key+'_update').fadeOut(800).fadeIn(800);
});
</script>
<!-- <script src="chat.js"></script> -->
<script type="module" src="chat.js"></script>
</body>
</html>





















