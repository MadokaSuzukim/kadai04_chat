<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>My Chat App</title>
<link rel="stylesheet" href="style.css"> 
    <!-- 設定内容 -->
</head>
<body>
    <div id="appTitle">
        <h1>My Chat App</h1>
    </div>
    <div id="header">
        <div id="hamburgerIcon">&#9776; 設定</div>
    </div>
    <div id="settings" style="display: none;">
        <!-- 設定内容 -->
        <div>
            <label for="fontSize">フォントサイズ:</label>
            <select id="fontSize">
                <option value="small">小さい</option>
                <option value="medium" selected>標準</option>
                <option value="large">大きい</option>
            </select>
        </div>
        <div>
            <label for="theme">テーマ:</label>
            <select id="theme">
                <option value="light" selected>ライトモード</option>
                <option value="dark">ダークモード</option>
            </select>
        </div>
        <div>
            <label for="language">言語:</label>
            <select id="language">
                <option value="ja" selected>日本語</option>
                <option value="en">English</option>
            </select>
        </div>
    </div>
       
    
    <!-- 設定内容 -->
    <div>
        <input type="text" id="searchQuery" placeholder="メモを検索...">
        <button id="searchButton">検索</button>
    </div>
<!-- コンテンツ表示画面 -->
<div> 
    名前：<input type="text" id="uname"> 
</div>
<div style="display: flex; align-items: center;">
    <div>
        日付：<input type="date" id="day">
    </div>
    <div style="margin-left: 10px;">
        <label for="category">カテゴリ:</label>
        <select id="category">
            <option value="仕事">仕事</option>
            <option value="個人">個人</option>
            <option value="家庭">家庭</option>
            <!-- 他のカテゴリオプション -->
        </select>
    </div>
</div>
<div>
    <textarea id="text" cols="30" rows="10"></textarea>
    <button id="send">送信</button>
</div>
<div id="output" style="overflow: auto;height: auto;"></div>

<div id="shareButtons">
    <button id="shareOnLine">LINEで共有</button>
    <button id="shareOnTwitter">Twitterで共有</button>
</div>
<!--/ コンテンツ表示画面 -->



<!-- JQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<!--** 以下Firebase **-->
<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getDatabase, ref, push, set,update,remove, onChildAdded, onChildChanged, onChildRemoved } 
    from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyApiys7KPXh3WlPtWkAimEd8dRJKVVeY7k",
      authDomain: "self-coath.firebaseapp.com",
      databaseURL: "https://self-coath-default-rtdb.firebaseio.com",
      projectId: "self-coath",
      storageBucket: "self-coath.appspot.com",
      messagingSenderId: "375259169680",
      appId: "1:375259169680:web:f510004f6764f128542915",
      measurementId: "G-3JB40K3NG4"
    };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);//RealtimeDBに接続
    const dbRef = ref(db, "chat");//RealtimeDB内の"chat"を使う


    // 送信
    $("#send").on("click",function() {
    const msg = {
        uname: $("#uname").val(),
        day: $("#day").val(),
        text: $("#text").val()
    }
    // console.log(msg); //チェックしたら消す
    const newPostRef = push(dbRef); //ユニークキーを生成
    set(newPostRef, msg);           //"chat"にユニークKEYをつけてオブジェクトデータを登録
    console.log(newPostRef);//これをみたら、どういう処理なんかわかる！
});
    // 受診
    onChildAdded(dbRef, function (data) {
        const msg =data.val();
        const key =data.key; //ユニークキー 削除・更新に必須
        let h ='<p id="'+key+'">';
            h += msg.uname;
            h += msg.day;
            h += '<span contentEditable="true"id="'+key+'_update">'+msg.text+'</span>';
            h += '<span class="remove" data-key="'+key+'">🚮</span>'
            h += '<span class="update" data-key="'+key+'">🆙</span>'
            // h += msg.text;
            h +='</p>';
            $("#output").prepend(h);
});

    // 削除イベント
    $("#output").on("click",".remove",function(){
        const key = $(this).atte("data-key");
        const remove_item = ref(db,"chat/+key");
        remove(remove_item);//Firebaseデータ削除関数
    });

    // 更新イベント
    $("#output").on("click", ".update", function() {
        const key = $(this).attr("data-key");
        update(ref(db, "chat/"+key),{
            text:$("#" + key+'_update').html()

        });
    });

// 削除処理がFirebase側で実行されたら
onChildRemoved(dbRef, (data) =>{
    $("#"+data.key).remobe(); //DOM操作関数（対象を削除）
})

// 更新処理がFirebase側でじっこうされたらイベント発生！
onChildChanged(dbRef, (data) =>{
  $("#"+data.key+'_update').html(data.val().text);
  $("#"+data.key+'_update').fadeOut(800).fadeIn(800);
});
</script>
<!-- <script src="chat.js"></script> -->
<script type="module" src="chat.js"></script>
</body>
</html>





















